### 官网：https://perrykum.github.io/ImageOverlay/index.html
---

## ImageOverlay —— 安卓掌机全局遮罩工具

让任意 PNG 遮罩“强行”显示在屏幕顶层，不依赖模拟器内置功能。

### 为什么需要它？
**很多安卓掌机的痛点：性能更好的模拟器往往不支持遮罩，支持遮罩的模拟器又不够高效。**

ImageOverlay 通过系统悬浮窗把你指定的遮罩图层铺在最前面，实现“全局遮罩”。无需改动或切换模拟器，任何应用都能叠加显示。

### 功能特色
- **快速使用**：一键选择图片并启动/关闭遮罩，适合临时需求。
- **预设分组**：按"组"管理多份遮罩配置（`组/配置`），便于分类与切换。
- **应用绑定**：支持遮罩组配置绑定应用，随应用自动切换/启动，实现智能遮罩管理。
- **硬件快捷键**：支持绑定硬件按键，通过实体按键快速控制遮罩开关。
- **自动关闭**：支持回到桌面后自动关闭遮罩，智能管理遮罩状态。
- **全局透明度**：统一的透明度设置，所有遮罩使用相同的透明度配置，支持实时调整。
- **默认配置与磁贴**：支持设为默认配置，并通过快捷设置磁贴（Quick Settings Tile）一键启停默认遮罩。
- **权限管理**：内置权限检查页面，支持快速跳转配置所需权限。
- **错误处理**：新增错误信息显示，软件崩溃后再次启动会显示错误信息，便于反馈bug。
- **无侵入**：不改动模拟器或游戏，无需 Root。
- **前台服务**：通过前台通知保持稳定运行。

### 典型场景
- 模拟器遮罩
- 准星/对齐辅助、按键位图提示
- 画面对齐、色弱/色盲辅助等

---

## 使用指南

### 1) 快速使用（无需预设）
1. 打开应用 → 底部导航选择“快速使用”。
2. 点击“选择图片”，挑选一张 PNG。
3. 首次使用会引导授予“在其他应用上层显示”的悬浮窗权限。
4. 点击“启动遮罩”开始，需停止时点击“关闭遮罩”。

提示：如果已有“预设”处于激活状态，将无法从“快速使用”再次启动（设计为互斥）。

### 2) 预设与分组
1. 底部导航选择"预设"。
2. 右上角"+"新建组（如：某游戏/某分辨率）。
3. 进入组 → "+" 新建配置，选择 PNG 图片；保存后列表中可见。
4. 点击配置行左侧状态圆点：绿色为激活，红色为未激活。激活会自动停用其他配置/快速使用遮罩。
5. **应用绑定**：长按组 → 选择"绑定应用"，可将遮罩组与特定应用关联，实现自动切换。

### 3) 默认配置与磁贴
- 在组内长按配置 → 选择"设为默认配置"。
- 在"预设"页顶部可看到默认配置信息与启停状态。
- 下拉系统快捷设置，添加"ImageOverlay 切换"磁贴，即可一键启停默认遮罩。

### 4) 硬件快捷键绑定
- 底部导航选择"设置"。
- 找到"硬件按键绑定"选项，点击进入绑定页面。
- 按下要绑定的硬件按键，系统会自动识别并绑定。
- 支持最多绑定3个不同的硬件按键。

### 5) 权限管理
- 底部导航选择"设置"。
- 找到"权限检查"选项，点击进入权限管理页面。
- 可以快速跳转到系统设置页面配置所需权限。
- 包括悬浮窗权限、使用情况访问权限等。

### 6) 全局透明度设置
- 底部导航选择"设置"。
- 找到"全局遮罩透明度"滑块，调整透明度（0-100%）。
- 支持防抖处理
---

## 权限说明
- `SYSTEM_ALERT_WINDOW`：用于在最前层显示遮罩。
- `FOREGROUND_SERVICE`：前台服务维持遮罩稳定运行。
- `USAGE_STATS`：用于应用绑定功能，监听应用切换以实现自动遮罩切换。

应用不访问网络，不上传任何数据；所有配置与图片均保存在本地你指定的位置。

---

## 兼容性与性能
- 目标/编译：`targetSdk 34`，`compileSdk 34`，最低 `minSdk 23`。
- 覆盖层为单张 PNG 全屏铺设，额外开销很小；建议使用与设备分辨率一致的透明 PNG 以获得最佳观感。
- 当前遮罩拉伸策略为 `FIT_XY`，若比例与屏幕不一致会被拉伸（见下方 FAQ）。
- 支持 Android 15+ 的兼容性优化，增强系统适配性。
- 全局透明度设置采用防抖机制，避免频繁调整时的性能影响。
- 适配黑暗模式

---

## 构建与运行
环境：Android Studio（Giraffe+）、JDK 17、Gradle（项目内置）。

1. 使用 Android Studio 打开本项目根目录。
2. 同步 Gradle，确保能够构建 `:app` 模块。
3. 连接设备或选择模拟器（建议真机/掌机设备）。
4. 运行 `app`。

主要技术版本：Kotlin 1.9.0，AGP 8.1.2，依赖见 `app/build.gradle`。

---

## 常见问题（FAQ）
- 看不到遮罩？
  - 请确认已授予"在其他应用上层显示"的权限；部分系统（如 MIUI 等）需要在系统权限管理中单独允许。
  - 若使用了分屏/画中画模式，系统层级可能影响显示，请先退出特殊窗口模式再试。

- 预设和快速使用为何不能同时开？
  - 为避免多重遮罩叠加造成性能与显示混乱，二者设计为互斥。

- 选择图片后保存失败或不显示？
  - 推荐在"设置"中先选择 SAF 目录；若使用传统路径，请确保目录可写。
  - 确认图片为 PNG 且未被系统清理；如为外置 SD 卡，请确保已授权读写。

- 遮罩被拉伸/比例不对？
  - 当前策略是 `FIT_XY` 全屏铺满。如果需要等比/位置/透明度等控制，请参考"路线图"进展或自行提交 PR。

- 应用绑定功能不工作？
  - 请确认已授予"使用情况访问权限"（USAGE_STATS），部分系统需要在系统设置中手动开启。
  - 确保绑定的应用已正确安装且可正常运行。

- 透明度调整没有效果？
  - 透明度设置是全局的，会应用到所有遮罩。如果正在运行的遮罩没有变化，请检查是否已正确保存设置。
  - 新启动的遮罩会自动使用最新的透明度设置。

- 如何彻底清理？
  - 在"设置 → 清除缓存"可删除无效图片或全部数据；卸载前也可手动删除授权目录中的 `ImageOverlay/`。

---

## 参与贡献
欢迎 PR 与 Issue：
- 提交前请尽量复现并附带设备/系统信息与简单复现步骤。

---

## 联系与社区
- QQ 群：710807742
- 作者博客：[perrykum.top](https://www.perrykum.top)
- Bilibili：<https://b23.tv/QFKN5JN>

---

## 开源许可
本项目基于 **GPL-3.0** 许可开源，详见仓库中的 `LICENSE` 文件。
您可以随意修改源代码以自用，但如果要分发，请将您的修改开源并继承 **GPL-3.0** 协议。

---

## 版本更新日志

### v3.0.0 (最新)
- **新增硬件快捷键支持**：支持绑定硬件按键，通过实体按键快速控制遮罩开关
- **新增自动关闭功能**：支持回到桌面后自动关闭遮罩，智能管理遮罩状态
- **新增权限检查页面**：内置权限管理界面，支持快速跳转配置所需权限
- **新增错误信息显示**：软件崩溃后再次启动会显示错误信息，可复制用于反馈bug
- **优化应用绑定逻辑**：改进遮罩随组自动切换的逻辑，确保状态同步
- **增强稳定性**：修复多个稳定性问题，提升系统适配性
- **性能优化**：添加防抖处理，避免频繁操作时的性能影响

### v2.0.0
- **新增应用绑定功能**：支持遮罩组配置绑定应用，随应用自动切换/启动，实现智能遮罩管理
- **新增全局透明度设置**：统一的透明度配置，所有遮罩使用相同设置，支持实时调整
- **优化磁贴功能**：简化磁贴操作，只保留开关遮罩功能
- **增强稳定性**：修复多个稳定性问题，提升系统适配性
- **性能优化**：添加防抖处理，避免频繁操作时的性能影响
- **Android 15+ 兼容**：增强对新版本系统的支持

### v1.0.0
- 基础功能实现
- 快速使用和预设分组
- 默认配置与磁贴支持

## 作者的话
作者本职是前端工程师，对安卓软件开发经验略有不足，如有 bug 欢迎反馈、指正


